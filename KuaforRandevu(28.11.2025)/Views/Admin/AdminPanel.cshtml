@model KuaforRandevu.Controllers.AdminPanelViewModel
@{
    ViewBag.Title = "Admin Panel";
    int adminId = (int)ViewBag.AdminId;
}
<link rel="stylesheet" href="~/css/adminpanel.css" asp-append-version="true" />

<h2>Randevular</h2>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Müşteri</th>
            <th>Telefon</th>
            <th>Tarih & Saat</th>
            <th>Durum</th>
            <th>İşlem</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var app in Model.Appointments)
        {
            <tr>
                <td>@app.CustomerName</td>
                <td>@app.Phone</td>
                <td>@(app.AppointmentDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
                <td>@app.Status</td>
                <td>
                    @if (app.Status != "İptal")
                    {
                        <button class="btn btn-danger" onclick="cancelAppointment(@app.Id)">İptal Et</button>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<h2>Boş Saatleri Blokla</h2>
<div class="mb-3">
    <input type="datetime-local" id="blockDateTime" class="form-control w-25 d-inline" />
    <input type="text" id="blockReason" placeholder="Sebep" class="form-control w-25 d-inline" />
    <button class="btn btn-warning" onclick="blockSlot()">Blokla</button>
</div>

<h3>Bloklanan Saatler</h3>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Tarih & Saat</th>
            <th>Sebep</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var b in Model.BlockedSlots)
        {
            <tr>
                <td>@(b.BlockedDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
                <td>@b.Reason</td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script>
        function cancelAppointment(id){
            $.post('/Admin/CancelAppointment', { appointmentId: id }, function(res){
                if(res.success){
                    alert("Randevu iptal edildi");
                    location.reload();
                } else alert(res.message);
            });
        }

        function blockSlot(){
            var dateTime = $('#blockDateTime').val();
            var reason = $('#blockReason').val();
            $.post('/Admin/BlockSlot', { adminId: @adminId, dateTime: dateTime, reason: reason }, function(res){
                if(res.success){
                    alert("Saat bloklandı");
                    location.reload();
                } else alert(res.message);
            });
        }
    </script>
}
